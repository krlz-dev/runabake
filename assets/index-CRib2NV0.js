import{E as y,S as x,C as v,H as M,V as u,A as E,M as S,a as w,b as g,D as H,c as T}from"./babylonjs-CldRdVB_.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class _{engine=null;canvas=null;initialize(t){return this.canvas=t,this.engine=new y(t,!0,{preserveDrawingBuffer:!0,stencil:!0,antialias:!0}),window.addEventListener("resize",()=>{this.engine?.resize()}),this.engine}createScene(){if(!this.engine)throw new Error("Engine not initialized. Call initialize() first.");const t=new x(this.engine);t.clearColor=new v(.5,.7,.9,1);const e=new M("defaultLight",new u(0,1,0),t);e.intensity=.7;const s=new E("defaultCamera",-Math.PI/2,Math.PI/4,15,u.Zero(),t);return s.attachControl(this.canvas,!1),s.inputs.attached.keyboard&&s.inputs.remove(s.inputs.attached.keyboard),t}startRenderLoop(t,e){if(!this.engine)throw new Error("Engine not initialized.");let s=performance.now();this.engine.runRenderLoop(()=>{const i=performance.now(),a=(i-s)/1e3;s=i,e&&e(a),t.render()})}getEngine(){return this.engine}getCanvas(){return this.canvas}dispose(){this.engine?.dispose(),this.engine=null,this.canvas=null}}class A{inputState;scene;keyMap;constructor(t){this.scene=t,this.keyMap=new Map,this.inputState={forward:!1,backward:!1,left:!1,right:!1,jump:!1,sprint:!1,interact:!1,mouseX:0,mouseY:0,mouseLeftClick:!1,mouseRightClick:!1},this.initializeListeners()}initializeListeners(){this.scene.onKeyboardObservable.add(t=>{const e=t.event.key.toLowerCase(),s=t.type===1;this.keyMap.set(e,s),this.updateInputState()}),this.scene.onPointerObservable.add(t=>{switch(t.type){case 1:t.event.button===0?this.inputState.mouseLeftClick=!0:t.event.button===2&&(this.inputState.mouseRightClick=!0);break;case 2:t.event.button===0?this.inputState.mouseLeftClick=!1:t.event.button===2&&(this.inputState.mouseRightClick=!1);break;case 4:this.inputState.mouseX=t.event.clientX,this.inputState.mouseY=t.event.clientY;break}})}updateInputState(){this.inputState.forward=this.isKeyPressed("w")||this.isKeyPressed("arrowup"),this.inputState.backward=this.isKeyPressed("s")||this.isKeyPressed("arrowdown"),this.inputState.left=this.isKeyPressed("a")||this.isKeyPressed("arrowleft"),this.inputState.right=this.isKeyPressed("d")||this.isKeyPressed("arrowright"),this.inputState.jump=this.isKeyPressed(" ")||this.isKeyPressed("space"),this.inputState.sprint=this.isKeyPressed("shift"),this.inputState.interact=this.isKeyPressed("e")||this.isKeyPressed("f")}isKeyPressed(t){return this.keyMap.get(t.toLowerCase())??!1}getInputState(){return{...this.inputState}}isMovingForward(){return this.inputState.forward}isMovingBackward(){return this.inputState.backward}isMovingLeft(){return this.inputState.left}isMovingRight(){return this.inputState.right}isJumping(){return this.inputState.jump}isSprinting(){return this.inputState.sprint}isInteracting(){return this.inputState.interact}isMoving(){return this.inputState.forward||this.inputState.backward||this.inputState.left||this.inputState.right}getMousePosition(){return{x:this.inputState.mouseX,y:this.inputState.mouseY}}reset(){this.keyMap.clear(),this.inputState={forward:!1,backward:!1,left:!1,right:!1,jump:!1,sprint:!1,interact:!1,mouseX:0,mouseY:0,mouseLeftClick:!1,mouseRightClick:!1}}dispose(){this.keyMap.clear()}}class b{scene;inputManager;constructor(t){this.scene=t,this.inputManager=new A(t),this.setupEnvironment()}setupEnvironment(){this.createGround(),this.createLighting(),this.createPlaceholderPlayer()}createGround(){const t=S.CreateGround("ground",{width:100,height:100,subdivisions:10},this.scene),e=new w("groundMaterial",this.scene);e.diffuseColor=new g(.8,.9,.8),e.specularColor=new g(.2,.2,.2),t.material=e,t.receiveShadows=!0}createLighting(){const t=new H("sunLight",new u(-1,-2,-1),this.scene);t.position=new u(20,40,20),t.intensity=1;const e=new T(1024,t);e.useBlurExponentialShadowMap=!0,e.blurKernel=32,this.scene.shadowGenerator=e}createPlaceholderPlayer(){const t=S.CreateBox("player",{size:2},this.scene);t.position=new u(0,1,0);const e=new w("playerMaterial",this.scene);e.diffuseColor=new g(.2,.4,.8),t.material=e;const s=this.scene.shadowGenerator;s&&s.addShadowCaster(t),this.scene.player=t}update(t){this.handlePlayerMovement(t)}handlePlayerMovement(t){const e=this.scene.player;if(!e)return;const i=(this.inputManager.isSprinting()?6:3)*t,a=new u(0,0,0);if(this.inputManager.isMovingForward()&&(a.z+=1),this.inputManager.isMovingBackward()&&(a.z-=1),this.inputManager.isMovingLeft()&&(a.x-=1),this.inputManager.isMovingRight()&&(a.x+=1),a.length()>0){a.normalize(),e.position.addInPlace(a.scaleInPlace(i)),e.rotation&&(e.rotation.y=Math.atan2(a.x,a.z));const r=Math.sin(Date.now()*.01)*.1;e.position.y=1+Math.abs(r)}if(this.scene.activeCamera){const r=this.scene.activeCamera;r.target&&(r.target=u.Lerp(r.target,e.position,.1))}}getInputManager(){return this.inputManager}getScene(){return this.scene}dispose(){this.inputManager.dispose()}}class h{constructor(t,e,s,i,a,r,d,m,p){this.health=t,this.maxHealth=e,this.hunger=s,this.maxHunger=i,this.thirst=a,this.maxThirst=r,this.temperature=d,this.stamina=m,this.maxStamina=p,this.validateStats()}validateStats(){if(this.health<0||this.health>this.maxHealth)throw new Error("Health must be between 0 and maxHealth");if(this.hunger<0||this.hunger>this.maxHunger)throw new Error("Hunger must be between 0 and maxHunger");if(this.thirst<0||this.thirst>this.maxThirst)throw new Error("Thirst must be between 0 and maxThirst");if(this.stamina<0||this.stamina>this.maxStamina)throw new Error("Stamina must be between 0 and maxStamina")}static create(t,e,s=100,i=100,a=100,r=100,d=37,m=100,p=100){return new h(t,e,s,i,a,r,d,m,p)}withHealth(t){return new h(Math.max(0,Math.min(t,this.maxHealth)),this.maxHealth,this.hunger,this.maxHunger,this.thirst,this.maxThirst,this.temperature,this.stamina,this.maxStamina)}withHunger(t){return new h(this.health,this.maxHealth,Math.max(0,Math.min(t,this.maxHunger)),this.maxHunger,this.thirst,this.maxThirst,this.temperature,this.stamina,this.maxStamina)}withThirst(t){return new h(this.health,this.maxHealth,this.hunger,this.maxHunger,Math.max(0,Math.min(t,this.maxThirst)),this.maxThirst,this.temperature,this.stamina,this.maxStamina)}withTemperature(t){return new h(this.health,this.maxHealth,this.hunger,this.maxHunger,this.thirst,this.maxThirst,t,this.stamina,this.maxStamina)}withStamina(t){return new h(this.health,this.maxHealth,this.hunger,this.maxHunger,this.thirst,this.maxThirst,this.temperature,Math.max(0,Math.min(t,this.maxStamina)),this.maxStamina)}isAlive(){return this.health>0}isCriticallyHot(){return this.temperature<35||this.temperature>40}isStarving(){return this.hunger<=20}isDehydrated(){return this.thirst<=20}}class c{constructor(t,e,s){this.x=t,this.y=e,this.z=s}static create(t,e,s){return new c(t,e,s)}static zero(){return new c(0,0,0)}distanceTo(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+s*s+i*i)}add(t,e,s){return new c(this.x+t,this.y+e,this.z+s)}equals(t,e=.001){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e}toArray(){return[this.x,this.y,this.z]}toString(){return`Position(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)})`}}class l{constructor(t,e,s,i,a,r=!0){this.id=t,this.characterClass=e,this.name=s,this._stats=i,this._position=a,this._isAlive=r}static create(t,e,s,i,a=c.zero()){return new l(t,e,s,i,a)}get stats(){return this._stats}get position(){return this._position}get isAlive(){return this._isAlive}updateStats(t){return this._stats=t,this._isAlive=t.isAlive(),this}moveTo(t){return this._position=t,this}takeDamage(t){const e=this._stats.withHealth(this._stats.health-t);return this.updateStats(e)}heal(t){const e=this._stats.withHealth(this._stats.health+t);return this.updateStats(e)}eat(t){const e=this._stats.withHunger(this._stats.hunger+t);return this.updateStats(e)}drink(t){const e=this._stats.withThirst(this._stats.thirst+t);return this.updateStats(e)}updateTemperature(t){const e=this._stats.withTemperature(t);return this.updateStats(e)}useStamina(t){const e=this._stats.withStamina(this._stats.stamina-t);return this.updateStats(e)}regenStamina(t){const e=this._stats.withStamina(this._stats.stamina+t);return this.updateStats(e)}canUseStamina(t){return this._stats.stamina>=t}getStatusSummary(){return{isAlive:this._isAlive,isCritical:this._stats.health<=20,needsFood:this._stats.isStarving(),needsWater:this._stats.isDehydrated(),needsWarmth:this._stats.isCriticallyHot()}}toJSON(){return{id:this.id,characterClass:this.characterClass,name:this.name,stats:{health:this._stats.health,maxHealth:this._stats.maxHealth,hunger:this._stats.hunger,maxHunger:this._stats.maxHunger,thirst:this._stats.thirst,maxThirst:this._stats.maxThirst,temperature:this._stats.temperature,stamina:this._stats.stamina,maxStamina:this._stats.maxStamina},position:{x:this._position.x,y:this._position.y,z:this._position.z},isAlive:this._isAlive}}static fromJSON(t){const e=t.stats,s=t.position,i=h.create(e.health??100,e.maxHealth??100,e.hunger??100,e.maxHunger??100,e.thirst??100,e.maxThirst??100,e.temperature??37,e.stamina??100,e.maxStamina??100),a=c.create(s.x??0,s.y??0,s.z??0);return new l(t.id,t.characterClass,t.name,i,a,t.isAlive??!0)}}const o={BASE_HEALTH:100,BASE_HUNGER:100,BASE_THIRST:100,BASE_STAMINA:100};var f=(n=>(n.SURVIVOR="survivor",n.HUNTER="hunter",n.ENGINEER="engineer",n.MEDIC="medic",n.SCOUT="scout",n.SOLDIER="soldier",n.COOK="cook",n.SCIENTIST="scientist",n))(f||{});class L{engine;gameScene=null;character=null;updateInterval=null;constructor(){this.engine=new _}async initialize(){console.log("Initializing Wild Survival Game...");const t=document.getElementById("renderCanvas");if(!t)throw new Error("Canvas element not found");this.engine.initialize(t),console.log("Engine initialized");const e=this.engine.createScene();console.log("Scene created"),this.gameScene=new b(e),console.log("Game scene initialized"),this.character=l.create("player_1",f.SURVIVOR,"Player",h.create(o.BASE_HEALTH,o.BASE_HEALTH,o.BASE_HUNGER,o.BASE_HUNGER,o.BASE_THIRST,o.BASE_THIRST,37,o.BASE_STAMINA,o.BASE_STAMINA)),console.log("Character created:",this.character.name),this.engine.startRenderLoop(e,s=>{this.update(s)}),this.updateInterval=window.setInterval(()=>{this.updateSurvivalMechanics()},1e3),this.hideLoadingScreen(),console.log("Application initialized successfully")}update(t){this.gameScene&&this.gameScene.update(t),this.updateUI()}updateSurvivalMechanics(){if(!this.character||!this.character.isAlive)return;const t=this.character.stats.hunger-1/60;this.character=this.character.updateStats(this.character.stats.withHunger(t));const e=this.character.stats.thirst-1.5/60;this.character=this.character.updateStats(this.character.stats.withThirst(e));const s=this.gameScene?.getInputManager();if(s&&!s.isMoving()&&!s.isSprinting()){const a=Math.min(this.character.stats.stamina+.16666666666666666,this.character.stats.maxStamina);this.character=this.character.updateStats(this.character.stats.withStamina(a))}this.character.stats.isStarving()&&(this.character=this.character.takeDamage(.5)),this.character.stats.isDehydrated()&&(this.character=this.character.takeDamage(.5));const i=this.character.getStatusSummary();(i.needsFood||i.needsWater)&&console.warn("Character needs:",{food:i.needsFood,water:i.needsWater})}updateUI(){if(!this.character)return;const t=this.character.stats;this.updateStatBar("health",t.health,t.maxHealth),this.updateStatBar("hunger",t.hunger,t.maxHunger),this.updateStatBar("thirst",t.thirst,t.maxThirst),this.updateStatBar("stamina",t.stamina,t.maxStamina)}updateStatBar(t,e,s){const i=document.getElementById(`${t}-value`),a=document.getElementById(`${t}-bar`);if(i&&(i.textContent=Math.round(e).toString()),a){const r=e/s*100;a.style.width=`${Math.max(0,Math.min(100,r))}%`}}hideLoadingScreen(){const t=document.getElementById("loading");t&&(t.classList.add("hidden"),setTimeout(()=>{t.style.display="none"},500))}dispose(){this.updateInterval!==null&&clearInterval(this.updateInterval),this.gameScene?.dispose(),this.engine.dispose()}}window.addEventListener("DOMContentLoaded",()=>{const n=new L;n.initialize().catch(t=>{console.error("Failed to initialize application:",t)}),window.addEventListener("beforeunload",()=>{n.dispose()})});
//# sourceMappingURL=index-CRib2NV0.js.map
